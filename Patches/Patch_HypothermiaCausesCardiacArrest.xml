<?xml version="1.0" encoding="UTF-8"?>
<Patch>
  <!-- 1. ensure Hypothermia is a HediffWithComps -->
  <Operation Class="PatchOperationConditional">
    <xpath>/Defs/HediffDef[defName="Hypothermia"]/hediffClass</xpath>
    <nomatch Class="PatchOperationAdd">
      <xpath>/Defs/HediffDef[defName="Hypothermia"]</xpath>
      <value>
        <hediffClass>HediffWithComps</hediffClass>
      </value>
    </nomatch>
    <match Class="PatchOperationReplace">
      <xpath>/Defs/HediffDef[defName="Hypothermia"]/hediffClass</xpath>
      <value>
        <hediffClass>HediffWithComps</hediffClass>
      </value>
    </match>
  </Operation>
  <!-- 2. create the comps node if necessary -->
  <Operation Class="PatchOperationConditional">
    <xpath>/Defs/HediffDef[defName="Hypothermia"]/comps</xpath>
    <nomatch Class="PatchOperationAdd">
      <xpath>/Defs/HediffDef[defName="Hypothermia"]</xpath>
      <value>
        <comps></comps>
      </value>
    </nomatch>
  </Operation>
  <!-- 3. add our secondary condition -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/HediffDef[defName="Hypothermia"]/comps</xpath>
    <value>
      <li Class="MoreInjuries.HealthConditions.Secondary.HediffCompProperties_SecondaryCondition">
        <!-- map hypothermia severity to cardiac arrest chance -->
        <severityCurve>
          <points>
            <li>0, 0</li>
            <!-- never -->
            <li>0.2, 0</li>
            <!-- every ~2 days -->
            <li>0.35, 0.015</li>
            <!-- every ~0.75 days -->
            <li>0.6, 0.04</li>
            <!-- every ~0.25 days -->
            <li>0.8, 0.12</li>
          </points>
        </severityCurve>
        <handlers>
          <li Class="MoreInjuries.HealthConditions.Hypothermia.Secondary.HediffCompHandler_SecondaryCondition_CardiacArrest">
            <tickInterval>2000</tickInterval>
            <sendLetterWhenDiscovered>true</sendLetterWhenDiscovered>
            <chanceModifiers>
              <li Class="MoreInjuries.HealthConditions.Secondary.Handlers.ChanceModifiers.HediffChanceModifier_DisallowDeathResting"></li>
            </chanceModifiers>
            <hediffMakerProps Class="MoreInjuries.HealthConditions.Secondary.Handlers.HediffMakers.HediffMakerProperties_SingleHediff">
              <hediffMakerDef>
                <hediffDef>CardiacArrest</hediffDef>
                <minSeverity>0.01</minSeverity>
                <allowMultiple>false</allowMultiple>
                <allowDuplicate>false</allowDuplicate>
              </hediffMakerDef>
            </hediffMakerProps>
            <targetEvaluator Class="MoreInjuries.HealthConditions.Secondary.Handlers.TargetEvaluators.BodyPartHediffTargetEvaluator_Single">
              <target>Heart</target>
            </targetEvaluator>
          </li>
        </handlers>
      </li>
    </value>
  </Operation>
</Patch>