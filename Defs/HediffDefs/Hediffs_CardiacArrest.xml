<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <HediffDef ParentName="DiseaseBase">
    <defName>CardiacArrest</defName>
    <label>cardiac arrest</label>
    <description>Cardiac arrest is a sudden loss of blood flow resulting from the failure of the heart to effectively pump blood. The lack of blood flow causes the body to stop working properly, resulting in loss of consciousness and death if not treated immediately. Causes for cardiac arrest include conditions that starve the heart of oxygen, such as extreme blood loss.\n\nA skilled doctor must perform CPR to restore blood flow and hopefully restart the heart. In early stages of cardiac arrest, during ventricular fibrillation, a defibrillator can also be used to shock the heart back into a normal rhythm, which may be faster and more effective than CPR.</description>
    <maxSeverity>1</maxSeverity>
    <alwaysShowSeverity>true</alwaysShowSeverity>
    <defaultLabelColor>(255, 52, 52)</defaultLabelColor>
    <tendable>false</tendable>
    <modExtensions>
      <li Class="MoreInjuries.AI.TreatmentModifiers.TreatmentModifiers_ModExtension">
        <modifiers>
          <li Class="MoreInjuries.AI.TreatmentModifiers.TreatmentModifier_LinkedHediff_SimpleCurve">
            <jobDef>UseDefibrillator</jobDef>
            <otherHediffDef>AdrenalineRush</otherHediffDef>
            <!-- Epinephrine can be used to increase the effectiveness of defibrillation -->
            <effectivenessCurve>
              <points>
                <li>0, 1</li>
                <li>0.2, 1.025</li>
                <li>0.4, 1.1</li>
                <li>0.6, 1.4</li>
                <li>0.8, 1.5</li>
                <li>1, 1.5</li>
                <!-- OD'ing on adrenaline reduces effectiveness -->
                <li>1.75, 0.9</li>
                <li>2, 0.8</li>
                <li>2.25, 0.6</li>
              </points>
            </effectivenessCurve>
          </li>
          <li Class="MoreInjuries.AI.TreatmentModifiers.TreatmentModifier_LinkedHediff_SimpleCurve">
            <jobDef>UseDefibrillator</jobDef>
            <otherHediffDef>MorphineBuildup</otherHediffDef>
            <!-- "A complication of morphine is the impediment of resuscitation efforts by its effect on decreasing blood pressure, heart rate, and respiration rate." -->
            <!-- ref: https://wms.org/magazine/magazine/1372/TCCC-Pain%20Management/default.aspx -->
            <effectivenessCurve>
              <points>
                <li>0.0, 1.0</li>
                <li>0.2, 0.95</li>
                <li>0.4, 0.85</li>
                <li>0.6, 0.75</li>
                <li>0.8, 0.6</li>
                <li>1.0, 0.4</li>
              </points>
            </effectivenessCurve>
          </li>
          <li Class="MoreInjuries.AI.TreatmentModifiers.TreatmentModifier_LinkedHediff_SimpleCurve">
            <jobDef>PerformCpr</jobDef>
            <otherHediffDef>AdrenalineRush</otherHediffDef>
            <!-- Epinephrine can be used to increase the effectiveness of CPR -->
            <effectivenessCurve>
              <points>
                <li>0, 1</li>
                <li>0.2, 1.025</li>
                <li>0.4, 1.1</li>
                <li>0.6, 1.4</li>
                <li>0.8, 1.5</li>
                <li>1, 1.5</li>
                <!-- OD'ing on adrenaline reduces effectiveness -->
                <li>1.75, 0.9</li>
                <li>2, 0.8</li>
                <li>2.25, 0.6</li>
              </points>
            </effectivenessCurve>
          </li>
          <li Class="MoreInjuries.AI.TreatmentModifiers.TreatmentModifier_LinkedHediff_SimpleCurve">
            <jobDef>PerformCpr</jobDef>
            <otherHediffDef>MorphineBuildup</otherHediffDef>
            <!-- "A complication of morphine is the impediment of resuscitation efforts by its effect on decreasing blood pressure, heart rate, and respiration rate." -->
            <!-- ref: https://wms.org/magazine/magazine/1372/TCCC-Pain%20Management/default.aspx -->
            <effectivenessCurve>
              <points>
                <li>0.0, 1.0</li>
                <li>0.2, 0.9</li>
                <li>0.4, 0.75</li>
                <li>0.6, 0.6</li>
                <li>0.8, 0.4</li>
                <li>1.0, 0.2</li>
              </points>
            </effectivenessCurve>
          </li>
        </modifiers>
      </li>
    </modExtensions>
    <comps>
      <li Class="HediffCompProperties_SeverityPerDay">
        <severityPerDay>8.0</severityPerDay>
      </li>
      <li Class="HediffCompProperties_Discoverable">
        <sendLetterWhenDiscovered>false</sendLetterWhenDiscovered>
      </li>
      <li Class="MoreInjuries.HealthConditions.CardiacArrest.HediffCompProperties_CardiacArrest"></li>
      <li Class="MoreInjuries.HealthConditions.Secondary.HediffCompProperties_CausedBy"></li>
      <li Class="MoreInjuries.HealthConditions.Secondary.HediffCompProperties_SecondaryCondition">
        <severityCurve>
          <points>
            <li>0, 0</li>
            <li>0.2, 0</li>
            <li>0.645, 0.4</li>
            <li>0.65, 1</li>
          </points>
        </severityCurve>
        <handlers>
          <!-- hypoxic damage to all parts of the body -->
          <li Class="MoreInjuries.HealthConditions.HypovolemicShock.Secondary.HediffCompHandler_SecondaryCondition_Hypoxia">
            <tickInterval>400</tickInterval>
            <chanceModifiers>
              <li Class="MoreInjuries.HealthConditions.Secondary.Handlers.Modifiers.HediffModifier_Reference">
                <hediffModifierDef>HypothermiaReducesHypoxia_ModiferDef</hediffModifierDef>
              </li>
            </chanceModifiers>
            <hediffMakerProps Class="MoreInjuries.HealthConditions.Secondary.Handlers.HediffMakers.HediffMakerProperties_SingleHediff">
              <hediffMakerDef>
                <hediffDef>OrganHypoxia</hediffDef>
                <minSeverity>1</minSeverity>
                <maxSeverity>5</maxSeverity>
                <allowMultiple>true</allowMultiple>
                <allowDuplicate>false</allowDuplicate>
              </hediffMakerDef>
            </hediffMakerProps>
            <targetEvaluator Class="MoreInjuries.HealthConditions.Secondary.Handlers.TargetEvaluators.BodyPartHediffTargetEvaluator_RandomBleedable">
              <excludedParts>
                <li>Heart</li>
                <li>Brain</li>
              </excludedParts>
            </targetEvaluator>
          </li>
          <li Class="MoreInjuries.HealthConditions.CardiacArrest.Secondary.HediffCompHandler_SecondaryCondition_Hypoxia">
            <tickInterval>200</tickInterval>
            <chanceModifiers>
              <li Class="MoreInjuries.HealthConditions.Secondary.Handlers.Modifiers.HediffModifier_Reference">
                <hediffModifierDef>HypothermiaReducesHypoxia_ModiferDef</hediffModifierDef>
              </li>
            </chanceModifiers>
            <hediffMakerProps Class="MoreInjuries.HealthConditions.Secondary.Handlers.HediffMakers.HediffMakerProperties_SingleHediff">
              <hediffMakerDef>
                <hediffDef>OrganHypoxia</hediffDef>
                <minSeverity>1.5</minSeverity>
                <maxSeverity>5</maxSeverity>
                <allowMultiple>true</allowMultiple>
                <allowDuplicate>false</allowDuplicate>
              </hediffMakerDef>
            </hediffMakerProps>
            <targetEvaluator Class="MoreInjuries.HealthConditions.Secondary.Handlers.TargetEvaluators.BodyPartHediffTargetEvaluator_RandomBleedable">
              <height>Middle</height>
              <depth>Inside</depth>
              <excludedParts>
                <li>Heart</li>
              </excludedParts>
            </targetEvaluator>
          </li>
          <li Class="MoreInjuries.HealthConditions.CardiacArrest.Secondary.HediffCompHandler_SecondaryCondition_Hypoxia">
            <tickInterval>250</tickInterval>
            <baseChance>0.375</baseChance>
            <chanceModifiers>
              <li Class="MoreInjuries.HealthConditions.Secondary.Handlers.Modifiers.HediffModifier_Reference">
                <hediffModifierDef>HypothermiaReducesHypoxia_ModiferDef</hediffModifierDef>
              </li>
              <li Class="MoreInjuries.HealthConditions.Secondary.Handlers.Modifiers.HediffModifier_LinkedHediff_SimpleCurve">
                <hediffDef>BrainDamage_Hypoxia</hediffDef>
                <!-- reduce chance for severe damage once hypoxia is already there -->
                <!-- brain damage is added over time, this curve gives brain damage a chance to manifest -->
                <severityCurve>
                  <points>
                    <li>0, 1</li>
                    <li>2, 0.9</li>
                    <li>4, 0.5</li>
                    <li>6, 0.25</li>
                  </points>
                </severityCurve>
              </li>
            </chanceModifiers>
            <hediffMakerProps Class="MoreInjuries.HealthConditions.Secondary.Handlers.HediffMakers.HediffMakerProperties_SingleHediff">
              <hediffMakerDef>
                <hediffDef>BrainDamage_Hypoxia</hediffDef>
                <minSeverity>0.1</minSeverity>
                <maxSeverity>2</maxSeverity>
                <allowMultiple>true</allowMultiple>
                <allowDuplicate>false</allowDuplicate>
              </hediffMakerDef>
            </hediffMakerProps>
            <targetEvaluator Class="MoreInjuries.HealthConditions.Secondary.Handlers.TargetEvaluators.BodyPartHediffTargetEvaluator_Single">
              <target>Brain</target>
            </targetEvaluator>
          </li>
        </handlers>
      </li>
    </comps>
    <stages>
      <li>
        <label>ventricular fibrillation</label>
        <lifeThreatening>true</lifeThreatening>
        <becomeVisible>true</becomeVisible>
        <minSeverity>0</minSeverity>
        <capMods>
          <li>
            <capacity>Consciousness</capacity>
            <setMax>0.01</setMax>
          </li>
          <statOffsets>
            <ComfyTemperatureMin>10</ComfyTemperatureMin>
            <ComfyTemperatureMax>-10</ComfyTemperatureMax>
          </statOffsets>
        </capMods>
      </li>
      <li>
        <label>clinical death</label>
        <lifeThreatening>true</lifeThreatening>
        <becomeVisible>true</becomeVisible>
        <minSeverity>0.65</minSeverity>
        <capMods>
          <li>
            <capacity>Consciousness</capacity>
            <setMax>0.01</setMax>
          </li>
          <statOffsets>
            <ComfyTemperatureMin>20</ComfyTemperatureMin>
            <ComfyTemperatureMax>-10</ComfyTemperatureMax>
          </statOffsets>
        </capMods>
      </li>
    </stages>
  </HediffDef>
</Defs>